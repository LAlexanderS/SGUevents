{% extends 'events/base.html' %} 
{% load static %} 
{% load main_tags %}
{% block title %} <title>Главная страница</title> {% endblock %} 

{% block filters %}
<div class="row filter-events-row mt-2">
    
    <div class="col-lg-2">
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle w-100" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Теги
            </button>
            <form action="" method="get" class="dropdown-menu bg-dark" data-bs-theme="dark" style="max-height: 200px; overflow-y: auto; width:170px;">
                <!-- Поле для поиска тегов -->
                <div class="form-check text-white" style="margin-left: 15px; margin-right:15px; padding: 0px;">
                    <input class="form-control w-100" id="search-tags" type="text" placeholder="Поиск тегов..." style="height: 35px;">
                </div>
    
                <!-- Список тегов -->
                <div id="tags-list">
                    {% for tag in tags %}
                        <div class="form-check text-white mx-3 tag-item" style="height: 5px;">
                            <input class="form-check-input" type="checkbox" name="f_tags" id="flexCheckDefault{{ forloop.counter }}" value="{{ tag }}" {% if request.GET.f_tags == tag %}checked{% endif %}>
                            <label class="form-check-label" for="flexCheckDefault{{ forloop.counter }}">{{ tag }}</label>
                            <br>
                        </div>
                    {% endfor %}
                </div>
    
                <!-- Для сохранения других фильтров -->
                {% for key, value in request.GET.items %}
                    {% if key != 'f_tags' and key != 'date_start' and key != 'date_end' %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endif %}
                {% endfor %}
    
                <!-- Кнопка для применения тегов -->
                <div class="text-center">
                    <button type="submit" class="btn btn-primary mt-3">Применить</button>
                </div>
            </form>
        </div>
    </div>

    <div class="col-lg-2">
        <div class="dropdown">
            <button class="btn btn-secondary dropdown-toggle w-100" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Спикеры
            </button>
            <form action="" method="get" class="dropdown-menu bg-dark" data-bs-theme="dark" style="max-height: 200px; overflow-y: auto; width:300px;">
                <!-- Поле для ввода, которое будет использоваться для поиска -->
                <div class="form-check text-white" style="margin-left: 15px; margin-right:15px; padding: 0px;">
                    <input class="form-control w-100" id="search-speakers" type="text" placeholder="Поиск спикеров..." style="height: 35px;" >
                </div>
    
                <!-- Список спикеров, который будет фильтроваться по мере ввода текста -->
                <div id="speakers-list">
                    {% for speaker in speakers %}
                        <div class="form-check text-white mx-3 speaker-item">
                            <input class="form-check-input" type="checkbox" name="f_speakers" id="flexCheckDefault{{ forloop.counter }}" value="{{ speaker }}" {% if request.GET.f_speakers == speaker %}checked{% endif %}>
                            <label class="form-check-label" for="flexCheckDefault{{ forloop.counter }}">{{ speaker }}</label>
                        </div>
                    {% endfor %}
                </div>
        
                {% comment %} Для объединения фильтров {% endcomment %}
                {% for key, value in request.GET.items %}
                    {% if key != 'f_speakers' %}
                        <input type="hidden" name="{{ key }}" value="{{ value }}">
                    {% endif %}
                {% endfor %}
                
                <div class="text-center">
                    <button type="submit" class="btn btn-primary mt-3">Применить</button>
                </div>
            </form>
        </div>
    </div>



    <!-- Сброс фильтров -->
    <div class="col-lg-2">
        <form action="{% url 'main:index' %}" method="get">
            <button class="btn btn-primary" type="submit">Сбросить</button>
        </form>
    </div>
</div>
{% endblock filters %}




{% block content %}
<!-- Контент на странице -->
<p>111111 {{speakers}}</p>

{% if events.category  == 'Онлайн' %}
	{% if events.id in registered.online %}
		<a href="#" class="btn btn-light btn-remove_app" data-event-id="{{ registered.online|get_item:events.id }}">
			Отмена регистрации
		</a>
        
	{% else %}
		<a href="#" class="btn btn-danger btn-sent_app" data-event-slug="{{ events.slug }}">
			Регистрация
		</a>
	{% endif %}

	<button class="btn btn-primary btn-comment" data-event-id="{{ events.id }}" data-model-type="online">Оставить отзыв</button>
{% elif events.category  == 'Оффлайн' %}
	{% if events.id in registered.offline %}
		<a href="#" class="btn btn-light btn-remove_app" data-event-id="{{ registered.offline|get_item:events.id }}">
			Отмена регистрации
		</a>
	{% else %}
		<a href="#" class="btn btn-danger btn-sent_app" data-event-slug="{{ events.slug }}">
			Регистрация
		</a>
	{% endif %}

	<button class="btn btn-primary btn-comment" data-event-id="{{ events.id }}" data-model-type="offline">Оставить отзыв</button>

{% elif events.category  == 'Достопримечательности' %}
	<button class="btn btn-primary btn-comment" data-event-id="{{ events.id }}" data-model-type="attractions">Оставить отзыв</button>
{% elif events.category  == 'Доступные к посещению' %}
	{% if events.id in registered.for_visiting %}
		<a href="#" class="btn btn-light btn-remove_app" data-event-id="{{ registered.for_visiting|get_item:events.id }}">
			Отмена регистрации
		</a>
		{% else %}
		<a href="#" class="btn btn-danger btn-sent_app" data-event-slug="{{ events.slug }}">
			Регистрация
		</a>
	{% endif %}
	<button class="btn btn-primary btn-comment" data-event-id="{{ events.id }}" data-model-type="for_visiting">Оставить отзыв </button>
{% endif %}


{% endblock content %}
